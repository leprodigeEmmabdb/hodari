{% extends 'Soluplus/MainApp/Utils/shared_front.html' %}
{% block page %}
  
<!-- Page-Title -->
<div class="row">
    <div class="col-sm-12">
        <h4 class="pull-left page-title">{{ title }}</h4>
        <ol class="breadcrumb pull-right">
            <li><a href="{% url 'front_index' %}">Accueil</a></li>
            <li class="active">Dashboard</li>
        </ol>
    </div>
</div>

<!-- Appel de la fonction message -->
{% include 'Soluplus/MainApp/Utils/message.html' with messages=messages only %}   

<div class="row">
    <div class="col-sm-12">
        <div class="panel panel-default">
            
            <div class="panel-body">
                <div class=" form">
                    <form class="needs-validation" novalidate method="POST" id="form" action="{% url 'front_post_add_expedition' %}">
                        {% csrf_token %}

                        <br>      

                        <div class="row row_formulaire">
                            <div class="col-md-6">
                                <label for="numero" class="control-label col-lg-4">Numéro</label>
                                <input name="numero" id="" class=" form-control">
                            </div> 

                        </div>
                        <div class="row row_formulaire">
                            <div class="col-md-6">
                                <table class="table table-striped table-bordered" style="overflow: auto; position: relative; display: inline-block; width:100%">
                                    <thead class="no-border">
                                        <tr>
                                            <th width="50%">Colis</th>
                                            <th width="5%"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbl_posts_body">
       
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="row row_formulaire">
                            <div class="col-lg-3 col-md-3 col-xs-6">
                                <a class="btn btn-primary" onclick="javascript:launch_scan('colis')" data-added="0"><i class="glyphicon glyphicon-qrcode"></i> Scan Colis</a>
                            </div>
                            <div class="col-lg-3 col-md-3 col-xs-6">
                                <a class="btn btn-primary add-record" data-added="0"><i class="glyphicon glyphicon-plus"></i> No Colis</a>
                            </div>
                        <div>
                        <br><hr><br>

                        <div class="row row_formulaire">
                            <div class="col-md-6">
                                <table class="table table-striped table-bordered" style="overflow: auto; position: relative; display: inline-block; width:100%">
                                    <thead class="no-border">
                                        <tr>
                                            <th width="50%">Groupage</th>
                                            <th width="5%"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbl_posts_body_2">
       
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="row row_formulaire">
                            <div class="col-lg-3 col-md-3 col-xs-6">
                                <a class="btn btn-primary" onclick="javascript:launch_scan('groupage')" data-added="0"><i class="glyphicon glyphicon-qrcode"></i> Scan groupage</a>
                            </div>
                            <div class="col-lg-3 col-md-3 col-xs-6">
                                <a class="btn btn-primary add-record-2" data-added="0"><i class="glyphicon glyphicon-plus"></i> No Groupage</a>
                            </div>
                        <div>
                        <br><br>

                        <div class="form-group">
                            <br> <br> <br>
                            <div class="col-lg-offset-2 col-lg-10">
                                <button class="btn btn-success waves-effect waves-light" type="submit">Enregistrer</button>
                                <button class="btn btn-default waves-effect" type="button">Annuler</button>
                            </div>
                        </div>
                    </form>
                </div> <!-- .form -->
            </div> <!-- panel-body -->
        </div> <!-- panel -->
    </div> <!-- col -->

    <div style="display:none;">
        <table id="sample_table" style="overflow: auto; position: relative; display: inline-block; width:100%">       
            <tr id="">       
                <td><input placeholder="Numéro colis" name="colis_numero" id="" class="colis form-control" data-container="body" data-live-search="true" data-hide-disabled="true" required></td>
                <td><a class="btn btn-xs delete-record" data-id="0"><i class="glyphicon glyphicon-trash"></i></a></td>  
            </tr>                                
        </table>
    </div>
    
    <div style="display:none;">
        <table id="sample_table_2" style="overflow: auto; position: relative; display: inline-block; width:100%">       
            <tr id="">       
                <td><input placeholder="Numéro groupage" name="groupage_numero" id="" class="groupage form-control" data-container="body" data-live-search="true" data-hide-disabled="true" required></td>
                <td><a class="btn btn-xs delete-record-2" data-id="0"><i class="glyphicon glyphicon-trash"></i></a></td>  
            </tr>                                
        </table>
    </div>

</div> <!-- End row -->


<script>
    //Colis
    var compteur = 0
    function launch_scan(type){
        JSBridge.launchAddByScanActivity(type);
    }
    function add_colis(){
        var result_scan = JSBridge.getResultScan();

        var content = jQuery('#sample_table tr');
        compteur++;
        element = null;    
        element = content.clone();
        element.attr('id', 'rec-'+compteur);
        element.find('.delete-record').attr('data-id', compteur);

        element.appendTo('#tbl_posts_body');
        element.find('.colis').attr('id', 'colis-'+compteur);

        jQuery('#colis-'+compteur).val(result_scan);
    }

    jQuery(document).delegate('a.add-record', 'click', function(e) {
        e.preventDefault();    
        var content = jQuery('#sample_table tr');
        compteur++;
        element = null;    
        element = content.clone();
        element.attr('id', 'rec-'+compteur);
        element.find('.delete-record').attr('data-id', compteur);

        element.appendTo('#tbl_posts_body');        
        element.find('.colis').attr('id', 'colis-'+compteur);
    });


   jQuery(document).delegate('a.delete-record', 'click', function(e) {
        e.preventDefault();
        /*var didConfirm = confirm("Are you sure You want to delete");
        if (didConfirm == true) {*/
            var id = jQuery(this).attr('data-id');
            var targetDiv = jQuery(this).attr('targetDiv');
            jQuery('#rec-' + id).remove();
            
            //regnerate index number on table
            $('#tbl_posts_body tr').each(function(index) {
            //alert(index);
            $(this).find('span.sn').html(index+1);
            });
            return true;
        /*} else {
            return false;
        }*/
    });

    //Groupage
    var compteur_2 = 0
    function launch_scan(type){
        JSBridge.launchAddByScanActivity(type);
    }
    function add_groupage(){
        var result_scan = JSBridge.getResultScan();

        var content = jQuery('#sample_table_2 tr');
        compteur_2++;
        element = null;    
        element = content.clone();
        element.attr('id', 'rec-groupage-'+compteur_2);
        element.find('.delete-record-2').attr('data-id', compteur_2);

        element.appendTo('#tbl_posts_body_2');
        element.find('.groupage').attr('id', 'groupage-'+compteur_2);

        jQuery('#groupage-'+compteur_2).val(result_scan);
    }

    jQuery(document).delegate('a.add-record-2', 'click', function(e) {
        e.preventDefault();    
        var content = jQuery('#sample_table_2 tr');
        compteur_2++;
        element = null;    
        element = content.clone();
        element.attr('id', 'rec-groupage-'+compteur_2);
        element.find('.delete-record-2').attr('data-id', compteur_2);

        element.appendTo('#tbl_posts_body_2');        
        element.find('.groupage').attr('id', 'colis-'+compteur_2);
    });


   jQuery(document).delegate('a.delete-record-2', 'click', function(e) {
        e.preventDefault();
        /*var didConfirm = confirm("Are you sure You want to delete");
        if (didConfirm == true) {*/
            var id = jQuery(this).attr('data-id');
            var targetDiv = jQuery(this).attr('targetDiv');
            jQuery('#rec-groupage-' + id).remove();
            
            //regnerate index number on table
            $('#tbl_posts_body_2 tr').each(function(index) {
                //alert(index);
                $(this).find('span.sn').html(index+1);
            });
            return true;
        /*} else {
            return false;
        }*/
    });

</script>

{% endblock %}