{% extends 'Soluplus/MainApp/Utils/shared.html' %}

{% block page %}
<style>
    .table-success{
        background-color:#5DC68A !important;
        color: #fff;
    }
    .table-success td a{
        color:#fff;
    }
    .table-danger{
        background-color:#FE8BA5 !important;
        color: #fff;
    }
    .table-danger td a{
        color:#fff;
    }
    .table-neutre{
        background-color:#fff !important;
        color: #000;
    }.table-danger td a{
        color:#000;
    }

</style>


<!-- Page-Title -->
<div class="row">
    <div class="col-sm-12">
        <h4 class="pull-left page-title">{{ title }}</h4>
        <ol class="breadcrumb pull-right">
            <li class="active">Dashboard</li>
            <li><a href="{% url 'app_recrutement_list_candidatures' %}">Liste Offres</a></li>
        </ol>
    </div>
</div>

<!-- Start Widget -->
<div class="row">
    <div class="col-md-6 col-sm-6 col-lg-3">
        <div class="mini-stat clearfix bx-shadow">
            <span class="mini-stat-icon bg-info"><i class="ion-ios7-paperplane "></i></span>
            <div class="mini-stat-info text-right text-muted">
                <span class="counter">{{statistique.totalCandidature}}</span>
                Total
            </div>
            <div class="tiles-progress">
                <div class="m-t-20">
                    <h5 class="text-uppercase">Total Candidature</h5>
                    <div class="progress progress-sm m-0">
                        <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;">
                            <span class="sr-only">100% Complete</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-sm-6 col-lg-3">
        <div class="mini-stat clearfix bx-shadow">
            <span class="mini-stat-icon bg-success"><i class="ion-ios7-paperplane "></i></span>
            <div class="mini-stat-info text-right text-muted">
                <span class="counter">{{statistique.totalcandidatvalide}}</span>
                Total
            </div>
            <div class="tiles-progress">
                <div class="m-t-20">
                    <h5 class="text-uppercase">Candidatures Validées</h5>
                    <div class="progress progress-sm m-0">
                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;">
                            <span class="sr-only">100% Complete</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-sm-6 col-lg-3">
        <div class="mini-stat clearfix bx-shadow">
            <span class="mini-stat-icon bg-danger"><i class="ion-ios7-paperplane"></i></span>
            <div class="mini-stat-info text-right text-muted">
                <span class="counter">{{statistique.totalcandidatdecline}}</span>
                Total
            </div>
            <div class="tiles-progress">
                <div class="m-t-20">
                    <h5 class="text-uppercase">Candidatures Déclinées</h5>
                    <div class="progress progress-sm m-0">
                        <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;">
                            <span class="sr-only">100% Complete</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6 col-sm-6 col-lg-3">
        <div class="mini-stat clearfix bx-shadow">
            <span class="mini-stat-icon bg-primary"><i class="ion-ios7-paperplane"></i></span>
            <div class="mini-stat-info text-right text-muted">
                <span class="counter">{{statistique.totalcandidatwaiting}}</span>
                Total
            </div>
            <div class="tiles-progress">
                <div class="m-t-20">
                    <h5 class="text-uppercase">Candidatures en Attente</h5>
                    <div class="progress progress-sm m-0">
                        <div class="progress-bar progress-bar-secondary" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 100%;">
                            <span class="sr-only">60% Complete</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


</div>

<div class="row">

    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                Dossiers Candidatures
            </div>
            <div class="panel-body">
                <div class="row row_formulaire">
                    <h6 class="" style="font-size:17px;"><a style="font-size:18px;" href="{% url 'app_recrutement_detail_offre_admin' offre.id %}">{{offre.titre}}</a></h6>
                    <div class="col-md-6">
                            <!-- <p>Offre :  <a href="{% url 'app_recrutement_detail_offre_admin' offre.id %}"> {{offre.titre}} </a> -->
                            <p>Localisation: <strong>{{offre.localisation}}</strong></p>
                            <p>Type de Contrat: <strong>{{offre.typecontrat}}</strong> </p>
                            <p>Date de cloture: <strong>{{offre.dateclose|date:'d/m/Y'}}</strong> </p>
                            <p>Entreprise: <strong>{{offre.entreprise}}</strong> </p>
                    </div>
                    <div class="col-md-6">
                        <button class="btn btn-success" id="clor" onclick ="cloturer()" style="float: right;">Cloturer Dossier</button>
                    </div>
                </div>
                <br>
                <h5 id="msg" style="text-align: center;color:#FE557A;display:none;">DOSSIER CLOTURE VEUILLEZ GENERER LE RAPPORT DES CANDIDATURES</h5>
                <br>
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="table-responsive">
                        <table id="datatable" class="table table-striped table-bordered table-responsive">
                            <thead>
                                <tr>
                                    <th>Reference</th>
                                    <th>Candidat</th>
                                    <th>Email</th>
                                    <th>Date Inscrite</th>
                                    <th>CV</th>
                                    <th>Lettre Motivation</th>
                                    <th>Diplomes</th>
                                    <th>Statut</th>
                                </tr>
                            </thead>
                            <tbody id='dossierbody'>
                                {% for item in model %}
                                <tr {% if item.status == 2 %}class="table-success"{% elif item.status == 3 %}class="table-danger"{% else %}class="table-neutre"{% endif %}>
                                    <td> <a href="{% url 'app_recrutement_get_traitement_candidature' item.id %}">{{item.reference}}</a></td>
                                    <td>
                                        <a href="{% url 'app_recrutement_detail_candidat_admin' item.candidat.id %}">{{item.candidat.prenom}} - {{item.candidat.nom}}</a>
                                    </td>
                                    <td>{{item.candidat.email}}</td>
                                    <td>{{item.dateinscrit|date:'d/m/Y'}}</td>

                                    <td>
                                       <a href="{{item.cv.url}}">{{item.cv.name}}</a>
                                    </td>
                                    <td><a href="{{item.motivation.url}}">{{item.motivation.name}}</a></td>
                                    <td>
                                        <ul>
                                            {% for el in item.diplome.all %}
                                            <li><a href="{{el.file.url}}">{{ el.file.name }}</a></li>
                                            {% endfor %}
                                        </ul>
                                    </td>
                                    <td>
                                        {% if item.status == 1 %}
                                            En Attene
                                        {% elif item.status == 2 %}
                                            Accepté
                                        {% elif item.status == 3 %}
                                            Décliné
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                </div>
                <div class="col-md-12 col-sm-12 col-xs-12" id="rapport" style="margin-top:5%; display:none;">
                    <button class="btn btn-success" onclick="javascript:window.location.assign('{% url 'app_recrutement_printing_dossier_candidature' offre.id %}')"
                     style="float: right;">Generer Rapport</button>
                </div>

            </div>
        </div>
    </div>


</div> <!-- End Row -->
<script>
    $(document).ready(function () {
        var elig = "{{offre.est_actif}}";
        console.log(elig);
        if(elig == "False"){
            document.getElementById('dossierbody').style.display = "none";
            document.getElementById('rapport').style.display = "block";
            document.getElementById('msg').style.display = "block";
            document.getElementById('clor').style.display = "none";
        }
        else{
            document.getElementById('#dossierbody').style.display = "none";
        }
    });
</script>

<script>
    function cloturer(){
        var ref = {{offre.id}};
        console.log(ref);
        // var stat = "False";
		if (confirm("voulez-vous cloturer ce dossier?") == true) {
			clos_dossier(ref);
		} else {
		}
    }

    function clos_dossier(ref){
        $.get(
            "{% url  'app_recrutement_cloturer_cloutrer_json' %}",
            {ref : ref},
            function(data)
            {
                console.log("JSON STATUS" + JSON.stringify(data))
                window.location.reload();
            },
            "json"
        );
    }
</script>
<!-- <script>
    function genereted(){
        $(location).attr("href", "{% url 'app_recrutement_printing_dossier_candidature' offre.id %}");
    }
</script> -->
{% endblock %}