{% extends 'Soluplus/MainApp/Utils/shared.html' %}
{% load  staticfiles %}
{% block page %}
  
<link href="{% static 'Soluplus/css/select2.min.css' %}" rel="stylesheet" />
<link href="{% static 'Soluplus/css/select2-bootstrap.css' %}" rel="stylesheet" />
<script src="{% static 'Soluplus/js/select2.min.js' %}"></script>

<!-- Page-Title -->
<div class="row">
    <div class="col-sm-12">
        <h4 class="pull-left page-title">{{ title }}</h4>
        <ol class="breadcrumb pull-right">
            <li><a href="#">Accueil</a></li>
            <li class="active">Dashboard</li>
        </ol>
    </div>
</div>

<!-- Appel de la fonction message -->
{% include 'Soluplus/MainApp/Utils/message.html' with messages=messages only %}  

<div class="row">
    <div class="col-sm-12">
        <div class="panel panel-default">
            <div class="panel-body" style="padding: 40px;">
                <form class="needs-validation" novalidate enctype="multipart/form-data" method="POST"  action="{% url 'app_courrier_post_add_arrivee' %}">
                    {% csrf_token %}

                    <div class="row row_formulaire">

                        <div class="col-md-6">
                            <label for="nature_id" class="control-label col-lg-6">Nature du document</label> <br>
                            <select class="form-control tag" name="nature_id" style="margin-top: 5px !important;" required>
                                <option value="">Choisir une nature</option>
                                {% for item in natures %}
                                    <option value="{{item.id}}">{{item.designation}}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-md-2">
                            <label for="numero" >Numéro :</label>
                            <input name="numero" type="text" class="form-control" required>
                        </div>
                        
                        <div class="col-md-4">
                            <label for="date_envoi" >Date envoi :</label>
                            <div class="input-group">
                                <input name="date_envoi" type="text" class="form-control" placeholder="mm/dd/yyyy" id="datepicker" required>
                                <div class="invalid-tooltip">
                                    Veuillez remplir ce champs
                                </div>  
                                <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                            </div>
                        </div>
    
                    </div>

                    <hr>

                    <div class="row row_formulaire">
                        <div class="col-md-6">
                            <label for="expediteur_id" class="control-label col-lg-6">Expéditeur : </label> <br>
                            <select class="form-control tag" name="expediteur_id" style="margin-top: 5px !important;" required>
                                <option value="">Choisir un expéditeur</option>
                                {% for item in expediteurs %}
                                    <option value="{{item.id}}">{{item.nom}} {{item.postnom}} {{item.prenom}}</option>
                                {% endfor %}
                            </select>
                        </div> 

                        <div class="col-md-6">
                            <label for="objet" >Objet :</label>
                            <textarea name="objet"  class="form-control" cols="30" rows="10" required></textarea>
                        </div>
                    </div>

                    <hr>


                    <div class="row row_formulaire">
                        <div class="col-md-6">
                            <label for="date_reception" >Date réception :</label>
                            <div class="input-group">
                                <input name="date_reception" type="text" class="form-control" placeholder="mm/dd/yyyy" id="datepicker-inline" required>
                                <div class="invalid-tooltip">
                                    Veuillez remplir ce champs
                                </div>  
                                <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <label for="fichiers" >Pièces jointes :</label>
                            <input class="form-control" type="file" multiple name="fichiers" required>
                        </div>

                    </div>

                    <div class="row row_formulaire">
                        <div class="col-md-6">
                            <label for="date_reponse" >Repondre avant le :</label>
                            <div class="input-group">
                                <input name="date_reponse" type="text" class="form-control" placeholder="mm/dd/yyyy" id="datepicker-multiple" required>
                                <div class="invalid-tooltip">
                                    Veuillez remplir ce champs
                                </div>  
                                <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="remarques" >Remarques :</label>
                            <textarea name="remarques"  class="form-control" cols="30" rows="10" required></textarea>
                        </div>
                    </div>

                    <br> <br><hr>                

                    <div class="row row_formulaire">
                        <div class="col-md-12">
                            <table class="table table-striped table-bordered">
                                <thead class="no-border">
                                    <tr>
                                        <th width="50%">Destinataires</th>
                                        <th width="45%">Action attribuées</th>
                                        <th width="5%"></th>
                                    </tr>
                                </thead>
                                <tbody id="tbl_posts_body">
                                    <tr id="rec-1">
                                        
                                        <td>
                                            <select name="destinataire_id" class="selectpicker form-control article" id="1" data-container="body" data-live-search="true" title="Choisir un destinataire" data-hide-disabled="true" required>
                                                
                                                {% for item in employes %}
                                                    <option value="{{item.id}}">{{item.nom}} {{item.postnom}} {{item.prenom}} </option>
                                                {% endfor %}
                                            </select>
                                        </td>
                                        <td> <input type="text" name="action" class="form-control"> </td>
                                        <td><a class="btn btn-xs delete-record" data-id="1"><i class="glyphicon glyphicon-trash"></i></a></td>
                                        
                                    </tr>
                                    
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="row row_formulaire">
                        <div class="col-md-12">
                            <a class="btn btn-primary pull-right add-record" data-added="0"><i class="glyphicon glyphicon-plus"></i> Ajouter</a>
                        </div>
                    </div>
                    
                    
                    
                    <br>

                    
                    <div class="form-group">
                        <div class="col-lg-offset-1 col-lg-11">
                            <button class="btn btn-success waves-effect waves-light" type="submit">Enregistrer</button>
                            <button class="btn btn-default waves-effect" type="button">Annuler</button>
                        </div>
                    </div>
                </form>


                <div style="display:none;">
                    <table id="sample_table">
                        <tr id="">
                            <td>
                                <select name="destinataire_id" class="selectpicker2 form-control article" id="" data-container="body" data-live-search="true" title="Choisir un destinataire" data-hide-disabled="true" required>
                                    {% for item in expediteurs %}
                                    <option value="{{item.id}}">{{item.nom}} {{item.postnom}} {{item.prenom}} </option>
                                {% endfor %}
                                </select>
                                <td> <input type="text" name="action" class="form-control"> </td>
                            </td>
                            <td><a class="btn btn-xs delete-record" data-id="0"><i class="glyphicon glyphicon-trash"></i></a></td>
                        </tr>
                   </table>
                </div>
                
            </div> <!-- panel-body -->
        </div> <!-- panel -->
    </div> <!-- col -->
</div> <!-- End row -->

<script>
    jQuery(document).delegate('a.add-record', 'click', function(e) {
     e.preventDefault();    
     var content = jQuery('#sample_table tr'),
     size = jQuery('#tbl_posts >tbody >tr').length + 1,
     element = null,    
     element = content.clone();
     element.attr('id', 'rec-'+size);
     element.find('.delete-record').attr('data-id', size);

     element.appendTo('#tbl_posts_body');
     element.find('.sn').html(size);
     
     element.find('.article').attr('id', size);
     
     element.find('.selectpicker2').selectpicker('refresh');
   });


   jQuery(document).delegate('a.delete-record', 'click', function(e) {
     e.preventDefault();
     var didConfirm = confirm("Are you sure You want to delete");
     if (didConfirm == true) {
      var id = jQuery(this).attr('data-id');
      var targetDiv = jQuery(this).attr('targetDiv');
      jQuery('#rec-' + id).remove();
      
    //regnerate index number on table
    $('#tbl_posts_body tr').each(function(index) {
      //alert(index);
      $(this).find('span.sn').html(index+1);
    });
    return true;
  } else {
    return false;
  }
});

</script>

<script>
    $(".tag").select2({
        
        tags: true,
        theme:'bootstrap',
        createTag: function (params) {
            return {
            id: params.term,
            text: params.term,
            newOption: true
            }
        },
        templateResult: function (data) {
            var $result = $("<span></span>");

            $result.text(data.text);

            if (data.newOption) {
                var $result = $("<span></span>");
                $result.text('Créer ');
                $result.append(data.text);
            }

            return $result;
        }
        });
</script>



{% endblock %}